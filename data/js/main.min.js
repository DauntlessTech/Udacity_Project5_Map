function ViewModel(e,t,r){function o(e,r,o,a,s){cityMarkersArr.length>0&&(cityMarkersArr[0].setMap(null),cityMarkersArr=[],$("#info").text(""),$(n()).each(function(e){n()[e].setMap(null)}),n([]),s([])),r.geocode({address:o},function(r,l){if(l===google.maps.GeocoderStatus.OK){t=r[0].geometry.location,e.setCenter(r[0].geometry.location),e.setZoom(14),i.cityMarker=new google.maps.Marker({map:e,position:t,icon:"https://maps.gstatic.com/mapfiles/ms2/micons/red-dot.png",draggable:!1,infowindow:new google.maps.InfoWindow({content:o})}),i.cityMarker.infowindow.open(e,i.cityMarker),cityMarkersArr.push(i.cityMarker);{$.get("https://api.foursquare.com/v2/venues/search?&client_id=4DZ0UPQETEOFEHOWZHKDEDAVMELD1WW5GQWQWRM25M2IZSNS&client_secret=BTQAOLRHOAJPDQKYDG0I4XOPWPH4W5IZGDVNGZCXT1TCEWTF&v=20130815&ll="+t.lat()+", "+t.lng()+"&query="+a,function(t){console.log("api call succeded: "+new Date);var r;$(t.response.venues).each(function(a){r={lat:t.response.venues[a].location.lat,lng:t.response.venues[a].location.lng};var l=t.response.venues[a].name;null===l&&(l="Not Available");var c=t.response.venues[a].url,p=c;null===c&&(c="javascript: void(0)",p="Not Available");var f=t.response.venues[a].contact.formattedPhone;null===f&&(f="Not Available");var m=t.response.venues[a].contact.twitter;m=null===m?"Not Available":"@"+m;var u='<article class="uk-comment infowindow"><h3>'+l+'<h3> <h4 class="uk-comment-title">Web: <a href="'+c+'" target="_blank"> <img class="uk-icon-small uk-float-right" src="data/img/open.png" alt="Open In New Browser">'+p+'</a></h4> <div class="uk-comment-meta"><p> Phone: '+f+" | Twitter: "+m+'</p></div></article><hr class="uk=grid-divider"/>';s.push({name:t.response.venues[a].name,url:t.response.venues[a].url,phone:t.response.venues[a].contact.formattedPhone,twitter:t.response.venues[a].contact.twitter,city:o.toUpperCase(),id:a}),n.push(new google.maps.Marker({map:e,position:r,icon:"https://maps.gstatic.com/mapfiles/ms2/micons/blue-dot.png",infowindow:new google.maps.InfoWindow({content:u,id:a}),click:function(t){var r=this;$(n()).each(function(e){n()[e]!==n()[t]&&n()[e].infowindow.close()}),i.cityMarker.infowindow.close(),r.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){r.setAnimation(null)},750),r.infowindow.open(e,this)}}))})}).fail(function(){alert("Api call failed")}).done(function(){console.log("foursquare data recieved: "+new Date),$(n()).each(function(t){n()[t].setMap(e),n()[t].addListener("click",n()[t].click)})}).always(function(){console.log("foursquare finished: "+new Date)})}}else alert(""===o?"Search requires an address":"Geocode was not successful for the following reason: "+l)})}var i=this;i.address=ko.observableArray(),i.filter=ko.observableArray(),i.venues=ko.observableArray();var a=i.venues;i.markersArr=ko.observableArray();var n=i.markersArr;i.cityMarker=ko.observable(),i.bookmarks=ko.observableArray();var s=i.bookmarks;i.functions={markerSearch:function(e){var t=e.id;n()[t].click(t)},venueSearch:function(){var t=i.address(),n=i.filter();o(e,r,t,n,a)},bookmarkIt:function(e){var t=s.indexOf(e),r={info:e,marker:n()[e.id]};-1===t?(s.push(r),a.remove(e),r.marker.click(e.id)):(a.push(e.info),s.remove(e))},bookmarkSearch:function(t){t.marker.setMap(e,t.marker),t.marker.infowindow.open(e,t.marker),e.setCenter(t.marker.position)}}}function initMap(){var e,t={lat:47.605358,lng:-122.331099};e=new google.maps.Map(document.getElementById("map"),{zoom:8,center:t,disableDefaultUI:!0});var r=new google.maps.Geocoder;$(window).resize(function(){$("#map").height($(window).height()),$("#map").width($(window).width()),e.setCenter(t)});var o=[{featureType:"administrative",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"administrative.country",elementType:"geometry.stroke",stylers:[{visibility:"off"}]},{featureType:"administrative.province",elementType:"geometry.stroke",stylers:[{visibility:"off"}]},{featureType:"landscape",elementType:"geometry",stylers:[{visibility:"on"},{color:"#e3e3e3"}]},{featureType:"landscape.natural",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"all",stylers:[{color:"#cccccc"}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"transit.line",elementType:"geometry",stylers:[{visibility:"off"}]},{featureType:"transit.line",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"transit.station.airport",elementType:"geometry",stylers:[{visibility:"off"}]},{featureType:"transit.station.airport",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#FFFFFF"}]},{featureType:"water",elementType:"labels",stylers:[{visibility:"off"}]}];e.setOptions({styles:o}),ko.applyBindings(new ViewModel(e,t,r))}var cityMarkersArr=[];
